# Debounce –ª–æ–≥—ñ–∫–∞ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–≤—ñ—Ç–ª–∞

## –û–≥–ª—è–¥

–¶–µ–π PR –¥–æ–¥–∞—î debounce –º–µ—Ö–∞–Ω—ñ–∑–º –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å–≤—ñ—Ç–ª–∞, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ —Å–ø–∞–º—É –≤ –∫–∞–Ω–∞–ª–∞—Ö –∫–æ–ª–∏ —Å–≤—ñ—Ç–ª–æ "–º–æ—Ä–≥–∞—î" (–Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–µ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω—ñ/–≤–∏–∫–ª—é—á–µ–Ω–Ω—ñ).

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–ª–∏ —Å–≤—ñ—Ç–ª–æ –≤–∫–ª—é—á–∞—î—Ç—å—Å—è, –≤–æ–Ω–æ —á–∞—Å—Ç–æ "–º–æ—Ä–≥–∞—î" ‚Äî –≤–∏–º–∏–∫–∞—î—Ç—å—Å—è —ñ –≤–º–∏–∫–∞—î—Ç—å—Å—è –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä—ñ–æ–¥. –ë–µ–∑ debounce –±–æ—Ç –ø—É–±–ª—ñ–∫—É—î –∫–æ–∂–Ω—É –∑–º—ñ–Ω—É —Å—Ç–∞–Ω—É, —â–æ —Å—Ç–≤–æ—Ä—é—î –±–∞–≥–∞—Ç–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:

```
üü¢ 09:00 –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è
üî¥ 09:03 –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
üü¢ 09:04 –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è
üî¥ 09:07 –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
... —ñ —Ç–∞–∫ –¥–∞–ª—ñ
```

## –†—ñ—à–µ–Ω–Ω—è

### 1. Debounce –ª–æ–≥—ñ–∫–∞

- **–ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è**: 5 —Ö–≤–∏–ª–∏–Ω –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**: —Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω–∞–º–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–∏ `/setdebounce N` —Ç–∞ `/debounce`
- **–ù–∞–ø—Ä—è–º–æ–∫**: –¥–ª—è –æ–±–æ—Ö ‚Äî –ø–æ—è–≤–∏ —ñ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞
- –ë–æ—Ç —á–µ–∫–∞—î 5 —Ö–≤–∏–ª–∏–Ω —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –ø–µ—Ä–µ–¥ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—î—é

### 2. –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ

–°–∏—Å—Ç–µ–º–∞ –∑–±–µ—Ä—ñ–≥–∞—î:
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å –∑–∞ –ø–µ—Ä—ñ–æ–¥ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ
- –ß–∞—Å –ø–æ—á–∞—Ç–∫—É –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
- –ß–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É
- Pending —Å—Ç–∞–Ω (—è–∫–∏–π –æ—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è)

### 3. –§–æ—Ä–º–∞—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

#### –ü–æ—è–≤–∞ —Å–≤—ñ—Ç–ª–∞ (—Å—Ç–∞–±—ñ–ª—å–Ω–∞)
```
üü¢ 09:44 –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è
üïì –ô–æ–≥–æ –Ω–µ –±—É–ª–æ 5 –≥–æ–¥ 15 —Ö–≤
üóì –ù–∞—Å—Ç—É–ø–Ω–µ –ø–ª–∞–Ω–æ–≤–µ: 12:30 - 19:30
```

#### –ü–æ—è–≤–∞ —Å–≤—ñ—Ç–ª–∞ (–ø—ñ—Å–ª—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É)
```
üü¢ 09:44 –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è
üïì –ô–æ–≥–æ –Ω–µ –±—É–ª–æ 3 —Ö–≤ (–∑–∞–≥–∞–ª–æ–º –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–µ ~1 –≥–æ–¥ 38 —Ö–≤)
‚ö° –ë—É–ª–æ 8 –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å –∑–∞ —Ü–µ–π —á–∞—Å
üóì –ù–∞—Å—Ç—É–ø–Ω–µ –ø–ª–∞–Ω–æ–≤–µ: 12:30 - 19:30
```

#### –ó–Ω–∏–∫–Ω–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞ (—Å—Ç–∞–±—ñ–ª—å–Ω–µ, –ü–Ü–î –ß–ê–° –≥—Ä–∞—Ñ—ñ–∫–∞)
```
üî¥ 14:30 –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
üïì –í–æ–Ω–æ –±—É–ª–æ 5 –≥–æ–¥ 15 —Ö–≤
üóì –°–≤—ñ—Ç–ª–æ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è: 18:00
```

#### –ó–Ω–∏–∫–Ω–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞ (—Å—Ç–∞–±—ñ–ª—å–Ω–µ, –ü–û–ó–ê –≥—Ä–∞—Ñ—ñ–∫–æ–º)
```
üî¥ 10:15 –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
üïì –í–æ–Ω–æ –±—É–ª–æ 2 –≥–æ–¥ 30 —Ö–≤
‚ö†Ô∏è –ü–æ–∑–∞–ø–ª–∞–Ω–æ–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
```

#### –ó–Ω–∏–∫–Ω–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞ (–ø—ñ—Å–ª—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É)
```
üî¥ 09:44 –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
üïì –í–æ–Ω–æ –±—É–ª–æ 3 —Ö–≤ (–∑–∞–≥–∞–ª–æ–º –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–µ ~44 —Ö–≤)
‚ö° –ë—É–ª–æ 8 –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å –∑–∞ —Ü–µ–π —á–∞—Å
```

**–í–∞–∂–ª–∏–≤–æ:** –î–ª—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É –ù–ï –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è "–°–≤—ñ—Ç–ª–æ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è", —Ç–æ–º—É —â–æ —Ü–µ –Ω–µ –∑–∞ –≥—Ä–∞—Ñ—ñ–∫–æ–º (–º–æ—Ä–≥–∞–Ω–Ω—è –ø–æ–∑–∞ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏–º –ø–µ—Ä—ñ–æ–¥–æ–º).

### 4. –õ–æ–≥—ñ–∫–∞ –ø–æ–∫–∞–∑—É "–°–≤—ñ—Ç–ª–æ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è"

| –°–∏—Ç—É–∞—Ü—ñ—è | –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ—è–≤–∏? |
|----------|---------------------------|
| –ó–Ω–∏–∫–ª–æ –ø—ñ–¥ —á–∞—Å –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É | ‚úÖ –¢–∞–∫ |
| –ó–Ω–∏–∫–ª–æ –ø–æ–∑–∞ –≥—Ä–∞—Ñ—ñ–∫–æ–º (–º–æ—Ä–≥–∞–Ω–Ω—è/–Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–µ) | ‚ùå –ù—ñ |
| –ó–Ω–∏–∫–ª–æ –ø–æ–∑–∞ –≥—Ä–∞—Ñ—ñ–∫–æ–º (—Å—Ç–∞–±—ñ–ª—å–Ω–µ, –∞–≤–∞—Ä—ñ—è) | ‚ùå –ù—ñ, –ø–æ–∫–∞–∑–∞—Ç–∏ "‚ö†Ô∏è –ü–æ–∑–∞–ø–ª–∞–Ω–æ–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è" |

### 5. –ê–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥–∏

```bash
/setdebounce 5   # –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ 5 —Ö–≤–∏–ª–∏–Ω
/setdebounce 3   # –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ 3 —Ö–≤–∏–ª–∏–Ω–∏
/debounce        # –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
```

–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –≥–ª–æ–±–∞–ª—å–Ω–æ.

**–î—ñ–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω—å:** 1-30 —Ö–≤–∏–ª–∏–Ω  
**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ:** 3-5 —Ö–≤–∏–ª–∏–Ω

## –§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ

### 1. `src/config.js`
- –î–æ–¥–∞–Ω–æ `POWER_DEBOUNCE_MINUTES` –∑ —á–∏—Ç–∞–Ω–Ω—è–º –∑ –ë–î –∞–±–æ `.env` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 5)

### 2. `src/bot.js`
- –î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥ `/setdebounce` —Ç–∞ `/debounce`
- –Ü–º–ø–æ—Ä—Ç –Ω–æ–≤–∏—Ö handler —Ñ—É–Ω–∫—Ü—ñ–π

### 3. `src/handlers/admin.js`
- `handleSetDebounce(bot, msg, match)` - –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —á–∞—Å debounce
  - –í–∞–ª—ñ–¥–∞—Ü—ñ—è: 1-30 —Ö–≤–∏–ª–∏–Ω
  - –ó–±–µ—Ä—ñ–≥–∞—î –≤ –ë–î —è–∫ —Ä—è–¥–æ–∫
  - –ü–æ–≤—ñ–¥–æ–º–ª—è—î, —â–æ –∑–º—ñ–Ω–∏ –∑–∞—Å—Ç–æ—Å—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- `handleGetDebounce(bot, msg)` - –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å debounce

### 4. `src/powerMonitor.js`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (userState):**
```javascript
{
  currentState: 'on' | 'off' | null,      // –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π —Å—Ç–∞–Ω
  lastStableState: 'on' | 'off' | null,   // –û—Å—Ç–∞–Ω–Ω—ñ–π —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π —Å—Ç–∞–Ω
  lastStableAt: timestamp,                 // –ß–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
  
  // Debounce –ø–æ–ª—è:
  pendingState: 'on' | 'off' | null,      // –°—Ç–∞–Ω —â–æ –æ—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
  pendingStateTime: timestamp,             // –ö–æ–ª–∏ –ø–æ—á–∞–ª–æ—Å—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
  debounceTimer: timeout,                  // –¢–∞–π–º–µ—Ä –¥–ª—è debounce
  
  // –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ:
  instabilityStart: timestamp,             // –ü–æ—á–∞—Ç–æ–∫ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ
  switchCount: number,                     // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å
  
  // –°—Ç–∞—Ä—ñ –ø–æ–ª—è (–¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ):
  consecutiveChecks: number,
  isFirstCheck: boolean
}
```

**–õ–æ–≥—ñ–∫–∞ –≤ `checkUserPower(user)`:**

1. –Ø–∫—â–æ —Å—Ç–∞–Ω —Ç–∞–∫–∏–π –∂–µ —è–∫ `currentState` ‚Üí —Å–∫–∏–¥–∞—î–º–æ pending —ñ —Ç–∞–π–º–µ—Ä–∏
2. –Ø–∫—â–æ —Å—Ç–∞–Ω —Ç–∞–∫–∏–π –∂–µ —è–∫ `pendingState` ‚Üí –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ –æ—á—ñ–∫—É–≤–∞—Ç–∏
3. –Ø–∫—â–æ –Ω–æ–≤–∏–π —Å—Ç–∞–Ω:
   - –°–∫–∞—Å–æ–≤—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∞–π–º–µ—Ä
   - –ó–±—ñ–ª—å—à—É—î–º–æ `switchCount`
   - –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –Ω–æ–≤–∏–π `pendingState`
   - –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç–∞–π–º–µ—Ä –Ω–∞ `POWER_DEBOUNCE_MINUTES`
4. –ö–æ–ª–∏ —Ç–∞–π–º–µ—Ä —Å–ø—Ä–∞—Ü—å–æ–≤—É—î ‚Üí –ø—É–±–ª—ñ–∫—É—î–º–æ –∑–º—ñ–Ω—É —Å—Ç–∞–Ω—É

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è `handlePowerStateChange(user, newState, oldState, userState)`:**

- –û–±—á–∏—Å–ª—é—î —á–∏ –±—É–ª–∞ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å (`switchCount > 0`)
- –†–æ–∑—Ä–∞—Ö–æ–≤—É—î —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–æ—ó –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –∑–∞—Ä–∞–∑ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (`isCurrentlyOff()`)
- –§–æ—Ä–º—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º:
  - –°—Ç–∞–±—ñ–ª—å–Ω–∏–π —á–∏ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –ø–µ—Ä—ñ–æ–¥
  - –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏–π —á–∏ –ø–æ–∑–∞–ø–ª–∞–Ω–æ–≤–∏–π –ø–µ—Ä—ñ–æ–¥
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å
- –°–∫–∏–¥–∞—î –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ –ø—ñ—Å–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó

**–Ü–Ω—à—ñ –∑–º—ñ–Ω–∏:**
- –í–∏–¥–∞–ª–µ–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `DEBOUNCE_COUNT` (–±—ñ–ª—å—à–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)
- –û–Ω–æ–≤–ª–µ–Ω–æ `resetPowerMonitor()` –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä—ñ–≤
- –û–Ω–æ–≤–ª–µ–Ω–æ `startPowerMonitoring()` –¥–ª—è –ø–æ–∫–∞–∑—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è debounce

## –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### –ê–ª–≥–æ—Ä–∏—Ç–º debounce

```
1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É —Ä–æ—É—Ç–µ—Ä–∞
   ‚Üì
2. –°—Ç–∞–Ω –∑–º—ñ–Ω–∏–≤—Å—è?
   ‚îú‚îÄ –ù—ñ ‚Üí –°–∫–∏–¥–∞—î–º–æ pending, —è–∫—â–æ –≤—ñ–Ω —î
   ‚îî‚îÄ –¢–∞–∫ ‚Üí –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ
       ‚Üì
3. –¶–µ —Ç–æ–π —Å–∞–º–∏–π pending —Å—Ç–∞–Ω?
   ‚îú‚îÄ –¢–∞–∫ ‚Üí –ù—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ (–ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ –æ—á—ñ–∫—É–≤–∞—Ç–∏)
   ‚îî‚îÄ –ù—ñ ‚Üí –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ
       ‚Üì
4. –°–∫–∞—Å–æ–≤—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∞–π–º–µ—Ä (—è–∫—â–æ —î)
   ‚Üì
5. –ó–±—ñ–ª—å—à—É—î–º–æ switchCount
   ‚Üì
6. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –Ω–æ–≤–∏–π pending —Å—Ç–∞–Ω
   ‚Üì
7. –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç–∞–π–º–µ—Ä (5 —Ö–≤)
   ‚Üì
8. –ß–µ—Ä–µ–∑ 5 —Ö–≤ ‚Üí –ü—É–±–ª—ñ–∫—É—î–º–æ –∑–º—ñ–Ω—É
```

### –ü—Ä–∏–∫–ª–∞–¥ —Å—Ü–µ–Ω–∞—Ä—ñ—é

```
00:00  –°–≤—ñ—Ç–ª–æ —î (—Å—Ç–∞–±—ñ–ª—å–Ω–æ)
00:05  –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ ‚Üí pending: off, timer start (5 min), switch: 1
00:08  –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è ‚Üí pending: on, timer restart (5 min), switch: 2
00:10  –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ ‚Üí pending: off, timer restart (5 min), switch: 3
00:15  (5 —Ö–≤ –ø—Ä–æ–π—à–ª–æ –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∑–º—ñ–Ω–∏)
       ‚Üí –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è: "–°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ"
       ‚Üí –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∫–ª—é—á–∞—î: "–ë—É–ª–æ 3 –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å"
       ‚Üí –°–∫–∏–¥–∞—î–º–æ switchCount = 0
```

## –ú—ñ–≥—Ä–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ—Å–Ω—É—é—á—É —Ç–∞–±–ª–∏—Ü—é `settings` –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º–∏ –º—ñ–≥—Ä–∞—Ü—ñ—è–º–∏.

**–ù–æ–≤—ñ –∑–∞–ø–∏—Å–∏:**
```sql
INSERT INTO settings (key, value) VALUES ('power_debounce_minutes', '5');
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –Ü—Å–Ω—É—é—á—ñ —Ç–µ—Å—Ç–∏
- ‚úÖ –í—Å—ñ —ñ—Å–Ω—É—é—á—ñ —Ç–µ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å
- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –∑–º—ñ–Ω–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤

### –ù–æ–≤—ñ —Ç–µ—Å—Ç–∏ (test-debounce.js)
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å debounce –≤ config
- ‚úÖ Database settings API (getSetting/setSetting)
- ‚úÖ Debounce settings –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ PowerMonitor –º–∞—î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
- ‚úÖ Admin handlers –¥–ª—è debounce –ø—Ä–∏—Å—É—Ç–Ω—ñ
- ‚úÖ PowerMonitor –º—ñ—Å—Ç–∏—Ç—å debounce –ª–æ–≥—ñ–∫—É
- ‚úÖ Bot –º—ñ—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è debounce
- ‚úÖ Admin handlers —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ–≤–Ω—ñ—Å—Ç—é

### Code review
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω–æ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—É –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `DEBOUNCE_COUNT`
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å —Ç–∏–ø—ñ–≤ —É setSetting
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–∑–º—ñ–Ω–∏ –∑–∞—Å—Ç–æ—Å—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)

### Security check
- ‚úÖ CodeQL: 0 –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –∑–Ω–∞–π–¥–µ–Ω–æ

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—ñ—Å–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### –î–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤

1. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**
   ```
   /debounce
   ```

2. **–ó–º—ñ–Ω–∏—Ç–∏ —á–∞—Å debounce:**
   ```
   /setdebounce 3   # 3 —Ö–≤–∏–ª–∏–Ω–∏
   /setdebounce 10  # 10 —Ö–≤–∏–ª–∏–Ω
   ```

3. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –≤ –ë–î

4. **–ó–º—ñ–Ω–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –Ω–µ–≥–∞–π–Ω–æ** –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ —Å—Ç–∞–Ω—É

### –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

–ñ–æ–¥–Ω–∏—Ö –¥—ñ–π –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ. –ó–º—ñ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
- –ú–µ–Ω—à–µ —Å–ø–∞–º—É –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ–º—É —Å–≤—ñ—Ç–ª—ñ
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å
- –ß—ñ—Ç–∫–∏–π –ø–æ–∫–∞–∑ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö vs –ø–æ–∑–∞–ø–ª–∞–Ω–æ–≤–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å

## –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å

‚úÖ **–ü–æ–≤–Ω—ñ—Å—Ç—é –∑–≤–æ—Ä–æ—Ç–Ω–æ —Å—É–º—ñ—Å–Ω–æ:**
- –Ü—Å–Ω—É—é—á—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º–∞—é—Ç—å debounce –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- –Ø–∫—â–æ setting –Ω–µ –≤ –ë–î, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (5 —Ö–≤)
- –°—Ç–∞—Ä–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –Ω–µ –∑–º—ñ–Ω–µ–Ω–∏–π, —Ç—ñ–ª—å–∫–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–∏–π

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ .env (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

```env
# –ß–∞—Å debounce –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (—Ö–≤–∏–ª–∏–Ω–∏)
POWER_DEBOUNCE_MINUTES=5
```

–¶–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–µ–º–∞—î –≤ –ë–î.

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–ë–æ—Ç –ª–æ–≥—É—î –≤–∞–∂–ª–∏–≤—ñ –ø–æ–¥—ñ—ó debounce:

```
User 123: –ü–æ—á–∞—Ç–æ–∫ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ, –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –∑ on –Ω–∞ off
User 123: –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è #2 –Ω–∞ on
User 123: –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è #3 –Ω–∞ off
User 123: –û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ off –ø—Ä–æ—Ç—è–≥–æ–º 5 —Ö–≤
User 123: Debounce –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É off
üì¢ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–º—ñ–Ω—É —Å—Ç–∞–Ω—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–Ω–∞–ª -1001234567890
```

## –ü–æ–¥–∞–ª—å—à—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–ª–∏–≤—ñ –º–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:

1. **–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è debounce** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ** –∑–∞ –¥–µ–Ω—å/—Ç–∏–∂–¥–µ–Ω—å
3. **–ì—Ä–∞—Ñ—ñ–∫ –º–æ—Ä–≥–∞–Ω—å** –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —è–∫–æ—Å—Ç—ñ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è
4. **–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —á–∞—Å—Ç—ñ –º–æ—Ä–≥–∞–Ω–Ω—è** –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

## –†–µ–∑—é–º–µ

‚úÖ **–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:**
- Timer-based debounce (5 —Ö–≤ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–µ—Ä–µ–º–∏–∫–∞–Ω—å
- –†–æ–∑—É–º–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö vs –ø–æ–∑–∞–ø–ª–∞–Ω–æ–≤–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å
- –ê–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ë–î
- –ü–æ–≤–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ:**
- 15 –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏—Ö —Ç–µ—Å—Ç—ñ–≤ (7 —ñ—Å–Ω—É—é—á–∏—Ö + 8 –Ω–æ–≤–∏—Ö)
- Code review –ø—Ä–æ–π–¥–µ–Ω–æ
- Security check –ø—Ä–æ–π–¥–µ–Ω–æ
- –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∞

‚úÖ **–ì–æ—Ç–æ–≤–æ –¥–æ –¥–µ–ø–ª–æ—é!**
